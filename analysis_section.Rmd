```{r}
if (!exists("section1_title")) section1_title <- "Best / Worst"
if (!exists("section1_metrics")) section1_metrics <- c("Best", "Worst")
if (!exists("section2_title")) section2_title <- "Most / Least Polarizing"
if (!exists("color_by")) color_by <- "bookmaker"
```

# `r title`
## `r section1_title` {.tabset}
### `r params$year`

`r section1_metrics[1]`: `r get_result_value("current", dataset, "average", "best")`

`r section1_metrics[2]`: `r get_result_value("current", dataset, "average", "worst")`

```{r}
make_bar_plot(get(dataset), group, "average", color = color_by, timeframe = "current")
```
### To date

`r section1_metrics[1]`: `r get_result_value("all", dataset, "average", "best")`

`r section1_metrics[2]`: `r get_result_value("all", dataset, "average", "worst")`

```{r}
make_bar_plot(get(dataset), group, "average", color = color_by, timeframe = "all")
```

## `r section2_title` {.tabset}
### `r params$year`
Most: `r get_result_value("current", dataset, "stdev", "best")`

Least: `r get_result_value("current", dataset, "stdev", "worst")`

```{r}
make_bar_plot(get(dataset), group, "stdev", color = color_by, timeframe = "current")
```
### To date
Most: `r get_result_value("all", dataset, "stdev", "best")`

Least: `r get_result_value("all", dataset, "stdev", "worst")`

```{r}
make_bar_plot(get(dataset), group, "stdev", color = color_by, timeframe = "all")
```

```{r, eval = (dataset == "raters"), results = "asis"}
cat("## Favorite / Least Favorite Bookmaker", sep = "\n")
```
```{r, eval = (dataset == "raters")}
# Note: all time only
max_values <- raters_bookmakers == apply(raters_bookmakers, 1, max)
min_values <- raters_bookmakers == apply(raters_bookmakers, 1, min)

df <- raters_bookmakers %>%
  mutate(across(where(is.numeric), sprintf, fmt = '%.2f'))

df[max_values] <- cell_spec(df[max_values],
                            format =  "html",
                            background = "#ef8a62")
df[min_values] <- cell_spec(df[min_values],
                            format =  "html",
                            background = "#67a9cf")
df %>%
  kable(format = "html", escape = FALSE, booktabs=TRUE) %>%
  kable_styling() %>%
  add_header_above(c(" " = 1, "Bookmaker" = ncol(df)))
```